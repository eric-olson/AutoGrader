<div class="row" style="height: 500px;">
  <div class="col-md-12">
    <div id="status_div">
    </div>
    <h4>Test Results</h4>
    <div id="progress_bar_container" class="progress progress-bar-segmented">
    </div>
  </div>
  <div class="col-md-4">
    <div class="panel panel-default">

      <div class="panel-heading">
        <h3 class="panel-title"><%= @assignment.name %></h3>
      </div>
      <div class="panel-body">
        <p><%= @assignment.description %></p>

        <div class="btn-group btn-group-justified" role="group" aria-label="...">
          <div class="btn-group" role="group" id="restart_btn">
            <button type="button" class="btn btn-default">Restart</button>
          </div>

          <div class="btn-group" role="group" id="test_btn">
            <button type="button" class="btn btn-default">Test</button>
          </div>

          <div class="btn-group" role="group">
            <button type="button" class="btn btn-default" id="save_btn">Save</button>
          </div>

          <div class="btn-group" role="group">
            <button type="button" class="btn btn-default">Submit</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="col-md-8">

    <ul class="nav nav-tabs">
      <li class="active">
        <a href="#1" data-toggle="tab">Write</a>
      </li>
      <li>
        <a href="#2" data-toggle="tab">Upload</a>
      </li>
    </ul>

    <div class="tab-content">
      <div class="tab-pane active" id="1">
      <div id="editor"><%= @editor_file_contents %></div>

      <script>
      function getAnimatedProgressBar() {
        return '<div class="progress-bar progress-bar-striped active" role="progressbar" style="width:100%;background-color: darkcyan;">Running Tests</div>';
      }

      function getSaveMessageAlert() {
        return '<div class="alert alert-success fade in"><a href="#" class="close" data-dismiss="alert" aria-label="close">&times;</a>File saved successfully!</div>'
      }

      function getRestartMessageAlert() {
        return '<div class="alert alert-success fade in"><a href="#" class="close" data-dismiss="alert" aria-label="close">&times;</a>Reset file to the default spec.</div>'
      }

      var editor = ace.edit("editor");
      $( document ).ready(function() {
        editor.setTheme("ace/theme/chrome");
        editor.getSession().setMode("ace/mode/c_cpp");
      });

      $('#test_btn').on('click', function() {
        $('#progress_bar_container').html(getAnimatedProgressBar());

        $.ajax({
          type: 'post',
          url: 'testCode',
          data: {editor_text:editor.getValue(),id:<%=@assignment.id%>},
          success: function(response) {
            // Load the progress bar with the html from the response
            $('#progress_bar_container').html(response.progress_bar_html);
            // Enable popovers
            $('[data-toggle="popover"]').popover();
          }
        });
        return false;
      });

      $('#save_btn').on('click', function() {
        $.ajax({
          type: 'post',
          url: 'saveCode',
          data: {editor_text:editor.getValue(),id:<%=@assignment.id%>},
          success: function(response) {
            $('#status_div').html(getSaveMessageAlert());
          }
        });
      });

      $('#restart_btn').on('click', function() {
        $.ajax({
          type: 'post',
          url: 'restartCode',
          data: {editor_text:editor.getValue(),id:<%=@assignment.id%>},
          success: function(response) {
            $('#status_div').html(getRestartMessageAlert());
            editor.setValue(response.new_editor_content, -1);
          }
        });
      })
      </script>
    </div>

    <div class="tab-pane" id="2">
      <p>Interface to upload code</p>
    </div>

  </div>
</div>
</div>
